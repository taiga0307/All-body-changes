<div class="container">
	<div class="row">
		<%= render 'layouts/sidebar', products: @genre_status_products, gyms: @genre_status_gyms %><!-- サイドバーcol-xs-3 -->
		<div class="col-xs-9"><!-- 左右に余白、中央に配置 -->

		<% if params[:genre] == "item" %><!-- 検索フォームのプルダウンでITEMを選択した場合表示 -->
			<h2>Seatch Items</h2>
      <div class="row">
        <div class="productsallcount">
          全<%= @products.count %>件
        </div>
        <%= paginate @products %>
      </div>
      <div class="row">
        <% @products.each do |product| %>
          <div class="col-xs-6 col-lg-3" style="border:1px solid #ddd; background:#CCCCCC; padding: 3px; margin-top: 3px;">
            <div class="productbox">

              <!-- 画像 -->
              <div class="image-favorite-positon">
              <%= link_to customers_product_path(product.id), {class: "product-link"} do %>
                <%= image_tag product.product_picture_id.to_s,  size:"210x210" %>
              <% end %>
                <!-- お気に入り -->
                <div class="productfavorite-index">
                  <div id = "product_favorite_btn_<%= product.id %>">
                    <!-- create.jsとdestroy.jsに範囲を送るための記述 -->
                    <%= render "customers/product_favorites/product_favorite", product: product %><br>
                  </div>
                </div>
              </div>

          <%= link_to customers_product_path(product.id), {class: "product-link"} do %>

              <!-- ブランド -->
              <div class="productbrand-index">
                <%= product.product_brand.truncate(15) %>
              </div>

              <!-- 紹介文 -->
              <div class="productdescription-index">
                <%= product.product_name.truncate(30) %><br>
              </div>

              <!-- スター平均 -->
              <div class="productstar-index" id="star-rate-<%= product.id %>">
              </div>
              <script>
                //評価星平均
                  // turbolinks:loadはページの切り替えを検知するイベント
                  $(document).on('turbolinks:load', function() {
                    $('#star-rate-<%= product.id %>').raty({
                      size: 36,
                      starOff: "<%= asset_path('star-off.png') %>",
                      starOn: "<%= asset_path('star-on.png') %>",
                      starHalf: "<%= asset_path('star-half.png') %>",
                      half: true,
                      readOnly: true,
                      score: <%= product.product_comments.average(:product_rate).to_f.round(1) %>,
                      //注目ポイント↑ 平均点を算出し、round関数で切り上げ
                    });
                  });
              </script>

              <!-- 平均評価数 -->
              <div class="productaverage-index">
                <% if product.product_comments.average(:product_rate).to_i == 0  %>
                0点
                <% else %>
                <%= product.product_comments.average(:product_rate).round(1) %>点
                <% end %>
              </div>

              <!-- クチコミ合計数 -->
              <div class="reviewcount-index">
                口コミ<%= product.product_comments.count %>件
              </div>

                <!-- 価格 -->
                <div class="productprice-index">
                  価格相場：<%= product.price_with_tax(product.product_price) %>円(税込)
                </div>
          <% end %>
            </div>
          </div>
        <% end %>
      </div>
      <div class="row">
        <div class="productsallcount">
          全<%= @products.count %>件
        </div>
        <%= paginate @products %>
      </div>

		<% elsif params[:genre] == "club" %><!-- 検索フォームのプルダウンでCLUBを選択した場合表示 -->
			<h2>Club</h2>
      <div class="row">
        <div class="gymsallcount">
          全<%= @gyms.count %>件
        </div>
        <%= paginate @gyms %>
      </div>
      <div class="row">
        <% @gyms.each do |gym| %>
          <div class="col-xs-6 col-lg-3" style="border:1px solid #444444; background:#222222;  padding: 3px; margin-top: 3px;">
            <div class="gymbox">
              <!-- 画像 -->
              <div class="gym-image-favorite-positon">
              <%= link_to customers_gym_path(gym.id), {class: "gym-link"} do %>
                <%= image_tag gym.gym_picture_id.to_s,  size:"210x210" %>
              <% end %>
                <!-- お気に入り -->
                <div class="gym-favorite-index">
                  <div id = "gym_favorite_btn_<%= gym.id %>"><!-- create.jsとdestroy.jsに範囲を送るための記述 -->
                    <%= render "customers/gym_favorites/gym_favorite", gym: gym %><br>
                  </div>
                </div>
              </div>
          <%= link_to customers_gym_path(gym.id), {class: "gym-link"} do %>
              <!-- ブランド -->
              <div class="gymbrand-index">
                <%= gym.gym_brand.truncate(15) %>
              </div>
              <!-- 紹介文 -->
              <div class="gymdescription-index">
                <%= gym.gym_name.truncate(30) %><br>
              </div>
              <!-- スター平均 -->
              <div class="gymstar-index" id="star-rate-<%= gym.id %>">
              </div>
              <script>
                // turbolinks:loadはページの切り替えを検知するイベント
                $(document).on('turbolinks:load', function() {
                  $('#star-rate-<%= gym.id %>').raty({
                    size: 36,
                    starOff: "<%= asset_path('star-off.png') %>",
                    starOn: "<%= asset_path('star-on.png') %>",
                    starHalf: "<%= asset_path('star-half.png') %>",
                    half: true,
                    readOnly: true,
                    score: <%= gym.gym_comments.average(:gym_rate).to_f.round(1) %>,
                    //注目ポイント↑ 平均点を算出し、round関数で切り上げ
                  });
                });
              </script>
              <!-- 平均評価数 -->
              <div class="gymaverage-index">
                <% if gym.gym_comments.average(:gym_rate).to_i == 0  %>
                0点
                <% else %>
                  <%= gym.gym_comments.average(:gym_rate).round(1) %>点
                <% end %>
              </div>
              <!-- クチコミ合計数 -->
              <div class="gymreviewcount-index">
                口コミ<%= gym.gym_comments.count %>件
              </div>
          <% end %>
            </div>
          </div>
        <% end %>
      </div>
      <div class="row">
        <div class="gymsallcount">
          全<%= @gyms.count %>件
        </div>
        <%= paginate @gyms %>
      </div>
    <% end %>
		</div>
	</div>
</div>
